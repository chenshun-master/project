<!DOCTYPE html>
<html lang="en">

	<head>
		<!--  <meta content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" name="viewport" />-->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,height=device-height, initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
		<meta name="viewport" content="target-densitydpi=device-dpi, width=750px, user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta content="telephone=no" name="format-detection" />
        <link rel="stylesheet" type="text/css" href="/static/plugin/layer_mobile/need/layer.css" />
		<link rel="stylesheet" type="text/css" href="/static/css/backpwd.css" />
		<title>Title</title>
		<script src="/static/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="/static/js/rem.js" type="text/javascript" charset="utf-8"></script>
	
	</head>

	<body>
		<div class="con">
			<div class="wx-top">
			<a href="login.html"  class="zj"></a>
				<div class="wx-reg">		
					<h3 style="font-size:0.38rem;width: 95%;height: 127px;line-height: 127px;text-align: center;color: #1f1f1f">找回密码</h3>
<<<<<<< HEAD
			     	<p style="margin-top: 40px;"><input id="mobile" type="text"  placeholder="请输入你的手机号" maxlength="11" onkeyup = "value=value.replace(/[^\d]/g,'')" /><button id="code-btn" onclick="objClass.sendSms()">获取验证码</button></p>
					<p style="margin-top: 40px;"><input id="sms_code" type="text" placeholder="请输入你收到的验证码" maxlength="6" onkeyup = "value=value.replace(/[^\d]/g,'')"></p>
					<button id="btn" style="margin-top: 100px;" onclick="objClass.submit()">找回密码</button>
=======
			     	<p style="margin-top: 40px;"><input id="phone" type="text" name="phone" placeholder="请输入你的手机号"><button id="code-btn">获取验证码</button></p>
					<p style="margin-top: 40px;"><input id="code" type="text" name="code" placeholder="请输入你收到的验证码"></p>
					<button id="btn" style="margin-top: 100px;">找回密码</button>
					
>>>>>>> b9975a35d50b2627ffef71d5961a637ec6cbf675
				</div>
				<p class="weixin"><a href="/weixin/index/otherLogin?platform=weixin" class="qian"><img src="/static/image/reg/wx.jpg" width="80px" height="80px"/ style="float: left;margin-left: 100px;margin-left: 20px;"/><span style="margin-left: 30px;"> <<微信授权登录</span></a></p>
			</div>
		</div>
	</body>
    <script src="/static/plugin/layer_mobile/layer.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
        var  objClass = {
            loading:false,
            sendSmsCode:false,
            checkMobile:function(mobile){
                var reg_phone = /^[1][3,4,5,7,8][0-9]{9}$/;
                return reg_phone.test(mobile);
            },
            submit:function(){
                var mobile = $('#mobile').val();
                var sms_code = $('#sms_code').val();

                if(!this.checkMobile(mobile)){
                    layer.open({content: '手机号格式不正确！',skin: 'msg',time: 2});
                    return false;
                }

                if(sms_code == ''){
                    layer.open({content: '请填写验证码！',skin: 'msg',time: 2});
                    return false;
                }
                if(!this.loading){
                    $.ajax({
                        url:"/weixin/index/checkSmsCode",
                        type:'post',
                        data:{mobile:mobile,sms_code:sms_code},
                        dataType:'json',
                        beforeSend:function(){
                            objClass.loading = true;
                        },
                        complete:function(){
                            objClass.loading = false;
                        },
                        success:function(res){
                            if(res.code == 200){
                                window.location.href = '/weixin/index/rePwd?mobile='+res.data.mobile+'&verify_code='+ encodeURIComponent(res.data.verify_code);
                                return false;
                            }else if(res.code == 301){
                                layer.open({content: '请求参数错误',skin: 'msg',time: 2});
                                return false;
                            }else if(res.code == 302){
                                layer.open({content: '验证码错误',skin: 'msg',time: 2});
                                return false;
                            }else if(res.code == 303){
                                layer.open({content: '验证码已过期',skin: 'msg',time: 2});
                                return false;
                            }else {
                                layer.open({content: '验证码错误',skin: 'msg',time: 2});
                                return false;
                            }
                        }
                    });
                }
            },
            sendSms:function(){
                var mobile = $('#mobile').val();
                if(!this.checkMobile(mobile)){
                    layer.open({content: '手机号格式不正确！',skin: 'msg',time: 2});
                    return false;
                }
                if(!this.sendSmsCode){
                    $.ajax({
                        url:"/weixin/index/sendResetPwdSmsCode",
                        type:'post',
                        data:{mobile:mobile},
                        dataType:'json',
                        beforeSend:function(){
                            objClass.sendSmsCode = true;
                        },
                        complete:function(){
                            objClass.sendSmsCode = false;
                        },
                        success:function(res){
                            if(res.code == 200){
                                layer.open({content: '发送成功',skin: 'msg',time: 2});
                                return false;
                            }else if(res.code == 301){
                                layer.open({content: '请求参数错误',skin: 'msg',time: 2});
                                return false;
                            }else if(res.code == 302){
                                layer.open({content: '该用户未被使用',skin: 'msg',time: 2});
                                return false;
                            }else{
                                layer.open({content: '发送失败',skin: 'msg',time: 2});
                                return false;
                            }
                        }
                    });
                }
            }
        };
	</script>
</html>