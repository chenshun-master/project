{extend name="layout/layout" /}

{block name="cssOrcrsipt"}
<link rel="stylesheet" href="/static/weixin/css/inquiry.css">
<link rel="stylesheet" href="/static/plugin/mescroll/mescroll.min.css">
{/block}

{block name="main"}
<div class="wl-header-dd">
    {include file="layout:header" /}
    <div class="wl-liebiao">
        <ul>
            <a href="/weixin/index/index">
                <li>推荐</li>
            </a>
            <a href="/weixin/index/diaryUser">
                <li>日记</li>
            </a>
            <a href="/weixin/index/inquiry">
                <li class="actice">问答</li>
            </a>
            <a href="/weixin/shop/haveGood">
                <li>有好货</li>
            </a>
        </ul>
    </div>
</div>
<main id="container" class="mescroll">
    <div class="wl-answers-notice">
        {if($isLogin)}
            <div class="wl-notice-user">
                <img src="{$portrait}"  onerror="this.src ='/static/image/user/tou.png'">
                <div class="wl-user-notice">
                    <dl>{$nickname}</dl>
                    <dt>回答{$info['answer_num']}<i class="iconfont icon-yuandian"></i>提问{$info['inquiry_num']}</dt>
                </div>
                <div><span class="wl-me-answers">我的问答<i class="iconfont icon-back_left-copy"></i></span></div>
            </div>
        {else /}
            <div class="wl-notice-login"> <a href="{:url('/weixin/index/login',['redir'=>base64url_encode('/weixin/index/inquiry')])}" >马上登录</a>,参与问答</div>
        {/if}

        <div style="clear: both"></div>
        <ul class="wl-answers-answer">
            <li><i class="iconfont icon-xiugaiziliao wl-answer"></i>答题</li>
            <li class="wl-tan-questions"><i class="iconfont icon-icon_tiwen wl-questions "></i>提问</li>
        </ul>

        <div style="clear: both"></div>
    </div>

        <div id="container-list" class="wl-list-answers">

        </div>

        <!--<div class="wl-answers">-->
            <!--<div class="wl-answers-list">-->
                <!--<div class="wl-answers-title">-->
                    <!--除了基本补偿费用；土地补偿.安置费.地上附属物以及青苗费以外，-->
                    <!--还有一个按时签协搬迁奖励，只要米能够签协及时按时搬迁，原则上会给予不少于18000元的奖励。-->
                <!--</div>-->
                <!--<div class="wl-user-notice1">-->
                    <!--<dt>回答10<i class="iconfont icon-yuandian"></i>提问10</dt>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
        <!--<div style="clear: both"></div>-->

</main>

<div class="marsk-container">
        <div class="wl-tkyy-top"><span class="wl-cancel href"><i class="iconfont icon-back_light"></i>取消</span>提问 <span class="wl-release href">发布</span></div>
        <div class="wl-problem">
            <textarea type="text" placeholder="请输入问题(40字以内)" class="wl-probleone" maxlength="40"></textarea>

            <textarea type="text" placeholder="添加问题描述(选填)"  class="wl-probletwo"></textarea>
        </div>
</div>
{include file="layout/footer" /}
{/block}

{block name="script"}
<script src="/static/js/functions.js"></script>
<script src="/static/plugin/layui/layui.all.js"></script>
<script src="/static/plugin/mescroll/mescroll.min.js" charset="utf-8"></script>
<script id="templateList" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <div class="wl-answers" data-id="{{item.id}}">
        <div class="wl-answers-list">
            {{# if(item.userType == 4){ }}
            <div class="wl-answers-top">
                <img src="{{item.portrait}}" alt="" onerror="this.src ='/static/image/user/tou.png'">
                <div class="wl-answers-name">
                    <dt>{{item.nickname}}</dt>
                    <span class="wl-answers-Icon"></span>
                </div>
            </div>
            {{# } }}
            <div class="wl-answers-title">{{item.title}}</div>
            <div class="wl-user-notice1">
                <dt>{{item.ask_time}}<i class="iconfont icon-yuandian"></i>回答{{item.answer_num}}</dt>
            </div>
        </div>
    </div>
    <div style="clear: both"></div>
    {{#  }); }}
</script>
<script>
    $(".wl-tan-questions").click(function (event) {
        event.stopPropagation(); //停止事件冒泡
        $(".marsk-container").fadeIn();
    });

    //点击取消按钮关闭遮罩层
    $('.wl-cancel').click(function () {
        $(".marsk-container").fadeOut();
    });
    //textarea随着内容的变化而改变高度
    $('textarea').on('input', function () {
        this.style.height = (this.scrollHeight) + 'px';
    });
    $(window).keydown( function(e) {
        var key = window.event?e.keyCode:e.which;
        if(key.toString() == "13"){
            return false;
        }
    });
    var mescroll = new MeScroll("container", {
        down:{auto:true},
        up: {
            clearEmptyId: "container-list",
            page: {num: 0,size: 20},
            htmlNodata: '<p class="upwarp-nodata">-- 已加载全部 --</p>',
            isBounce: false,
            noMoreSize: 5,
            empty: {
                icon: "/static/weixin/shop/image/tuoian.png",
                tip: "亲,没有您要找的商品~", //提示
            },
            callback: function(page){
                listObj.searchList(page,function(curPageData){
                    mescroll.endSuccess(curPageData.length);
                    layui.laytpl(templateList.innerHTML).render(curPageData, function(html){
                        $('#container-list').append(html);
                    });
                }, function(){
                    mescroll.endErr();
                });
            }
        }
    });

    var listObj = {
        searchList: function (page, successCallback, errorCallback) {
            var data = $.extend({}, {page: page.num, page_size: page.size});
            $.ajax({
                url: "/weixin/api/getInquiryList",
                type: 'post',
                data: data,
                dataType: 'json',
                success: function (res) {
                    successCallback(res.data.rows);
                },
            });
        },
    };
</script>
{/block}