{extend name="layout/layout" /}
{block name="cssOrcrsipt"}
    <link rel="stylesheet" href="/static/css/doctor.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_890503_haekiko2b0f.css">
    <link rel="stylesheet" href="/static/plugin/mescroll/mescroll.min.css">
<style>
    body{
        background: #f8f8f8;
    }
</style>
{/block}


{block name="main"}

<!--这里编写主体内容-->
<div id="container"  class="mescroll">
    <div id="container-list" ></div>
</div>
{include file="layout/footer" /}
{/block}
{block name="script"}
<script src="/static/plugin/layui/layui.all.js"></script>
<script src="/static/plugin/mescroll/mescroll.min.js" charset="utf-8"></script>
<script id="demo" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
            <div class="wl-conter href cus-to-doctor-details" data-uid="{{item.user_id}}">
                <div class="wl-toux"><img src="{{item.portrait}}" onerror="this.src ='/static/image/user/tou.png'" width="41" height="41"></div>
                <div style="position: relative"><span class="wl-biao"></span></div>
                <div class="wl-pingjia">
                    <dl>{{item.real_name}} <span style="color: #7DB0E8;border: 1px solid #CCCCCC;border-radius: 3px;display: inline-block;font-size: 12px;">{{ item.duties}}</span></dl>
                    <dd>
                        {{#  if(item.hospital_name != null){ }}
                        {{ item.hospital_name}}
                        {{#  } }}
                    </dd>
                    <dt><i class="iconfont icon-xingji"></i>
                        <i class="iconfont icon-xingji"></i>
                        <i class="iconfont icon-xingji"></i>
                        <i class="iconfont icon-xingji"></i>
                        <i class="iconfont icon-xingji"></i>
                        <span style="margin-left: 8px">评价 <span style="padding: 0 3px 0 0px">|</span></span>
                        <span>{{item.case_num}}案例<span style="padding: 0 3px 0 3px;">|</span></span>
                        <span style="margin-top: 1px">{{item.article_num}}文章</span>
                    </dt>
                    <span class="iconfont icon-back_left-copy wl-renzheng" style="font-size: 25px;color: #AAAAAA"></span>
                </div>
            </div>
    {{#  }); }}
</script>

<script type="text/javascript">

    // var myObj = {
    //     doctor:{
    //         listData: {
    //             loading: false,
    //             ini: false,
    //             page: 0,
    //             page_total: 1,
    //             page_size: 15,
    //         },
    //         template:function(data){
    //             var head_img      =  (data.portrait == null) ? '':data.portrait;
    //             var hospital_name =  (data.hospital_name == null) ? '':data.hospital_name;
    //             return ;
    //         },
    //         loadList: function (me) {
    //             if (myObj.doctor.listData.loading) {
    //                 return false;
    //             }
    //
    //             myObj.doctor.listData.page++;
    //             if (myObj.doctor.listData.ini == true) {
    //                 if (myObj.doctor.listData.page > myObj.doctor.listData.page_total) {
    //                     me.resetload();
    //                     return false;
    //                 }
    //             }
    //
    //             $.ajax({
    //                 url: "/weixin/api/getDoctorList",
    //                 type: 'post',
    //                 data: {page: myObj.doctor.listData.page, page_size: myObj.doctor.listData.page_size},
    //                 dataType: 'json',
    //                 beforeSend: function () {
    //                     myObj.doctor.listData.loading = true;
    //                 },
    //                 complete: function () {
    //                     myObj.doctor.listData.loading = false;
    //                 },
    //                 success: function (res) {
    //                     if (res.code == 200) {
    //                         if ( myObj.doctor.listData.ini == false) {
    //                             myObj.doctor.listData.ini = true;
    //                             myObj.doctor.listData.page_total = res.data.page_total;
    //                             $('#cus-container-list').html('');
    //                         }
    //
    //                         layui.laytpl(demo.innerHTML).render(res.data.rows, function(html){
    //                             $('#cus-container-list').append(html);
    //                         });
    //                         if ( myObj.doctor.listData.page >=  myObj.doctor.listData.page_total) {
    //                             me.noData();
    //                         }
    //                     }
    //                     me.resetload();
    //                 }
    //             });
    //         }
    //     }
    // };
    //
    // $('#cus-container').dropload({
    //     scrollArea: window,
    //     loadUpFn: function (me) {
    //         myObj.doctor.listData.loading = false;
    //         myObj.doctor.listData.ini = false;
    //         myObj.doctor.listData.page = 0;
    //         myObj.doctor.listData.page_total = 1;
    //         myObj.doctor.loadList(me);
    //     },
    //     loadDownFn: function (me) {
    //         myObj.doctor.loadList(me);
    //     }
    // });


    $(document).on('click','.cus-to-doctor-details',function(){
        window.location.href = '/weixin/index/doctorDetails/uid/'+$(this).data('uid');
    });
    var mescroll = new MeScroll("container", {
        down:{auto:true},
        up: {
            clearEmptyId: "container-list",
            page: {num: 0,size: 20},
            htmlNodata: '<p class="upwarp-nodata">-- 已加载全部 --</p>',
            isBounce: false,
            noMoreSize: 5,
            // empty: {
            //     icon: "/static/weixin/shop/image/tuoian.png",
            //     tip: "亲,没有您要找的商品~", //提示
            // },
            callback: function(page){
                listObj.searchList(page,function(curPageData){
                    mescroll.endSuccess(curPageData.length);
                    layui.laytpl(demo.innerHTML).render(curPageData, function(html){
                        $('#container-list').append(html);
                    });
                }, function(){
                    mescroll.endErr();
                });
            }
        }
    });

    var listObj = {
        searchList: function (page, successCallback, errorCallback) {
            var data = $.extend({}, {page: page.num, page_size: page.size});
            $.ajax({
                url: "/weixin/api/getDoctorList",
                type: 'post',
                data: data,
                dataType: 'json',
                success: function (res) {
                    successCallback(res.data.rows);
                },
            });
        },
    };
</script>
{/block}
