<!DOCTYPE html>
<html lang="en">
<head>
    <!--  <meta content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" name="viewport" />-->
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width,height=device-height, initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=750px, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="telephone=no" name="format-detection"/>
    <link rel="stylesheet" type="text/css" href="/static/css/main.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/dropload.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/zhezhe1.css"/>
    <link rel="stylesheet" type="text/css" href="/static/css/function.css"/>
    <title>用户中心</title>
    <script src="/static/js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/static/js/rem.js" type="text/javascript" charset="utf-8"></script>
    <script src="/static/js/dropload.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/static/js/zepto.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<style>
    .souBak{
        color: #7DB0E8 !important;
    }
    i,.cus-article-href{
        cursor:pointer;
    }
</style>
<body style="background: #ffffff;">
<div class="con">
    <div class="wx-top">
        <img src="{$user_info['portrait']}" alt="" class="wx-img" onerror="this.src='/static/image/user/tou.png '" />
        <div class="wx-con">
            <h3 style="font-size:0.34rem;color: #FFFFFF;margin-top: 22px;">{$user_info['nickname']}</h3>
            <p class="wl-jianj">{$user_info['profile']}</p>
            <?php if($is_friend === true):?>
                <button onclick="redream.showTip('此功能暂未开放...')">私信</button>
            <?php elseif($is_friend === false):?>
                <button  class="wl-haoyou" onclick="myObj.showAddFriend()">加好友</button>
            <?php endif;?>
        </div>
    </div>
    <div class="wx-boy">
        <ul class="wx-lie">
            <li style="	border-right: 1px solid gray;">文章<span>{$statistics['type_1']['total']}</span></li>
            <li style="border-right: 1px solid gray;">视频<span>{$statistics['type_2']['total']}</span></li>
            <li style="border-right: 1px solid gray;">案例<span>{$statistics['type_3']['total']}</span></li>
            <li>问答<span>{$statistics['type_4']['total']}</span></li>
        </ul>
    </div>
    <div class="wx-content">
        <div class="top">
            <div id="ul" style="border-bottom: 1px solid #EEEEEE;border-top: 10px solid #EEEEEE;">
                <span id="one" style="margin-left: 207px;">文章</span>
                <span id="two">视频</span>
                <span id="three">粉丝</span>
            </div>
        </div>
        <div class="xia">
            <div class="one ones content" >
            	<div id="wl-article"></div>
            </div>
            <div class="one oner content2" style="display: none;">
				<div id="wl-video"></div>
            </div>
            <div class="one" style="display: none;">
                <!--<div class="wx-you">-->
                    <!--<div class="you1">-->
                        <!--<img src="" alt=""/>-->
                        <!--<dl>-->
                            <!--<dt>用户名称</dt>-->
                            <!--<dd>介绍介绍介绍介绍</dd>-->
                        <!--</dl>-->
                        <!--<button>私信</button>-->
                    <!--</div>-->
                <!--</div>-->
            </div>
        </div>
    </div>
</div>

<div class="wl-zhezhao">
    <div class="wl-zhe1" style="height: 515px">
        <p class="wl-renzh">申请备注</p>
        <div class="wl-neie1">
            <p>你需要发送验证申请，等待对方通过</p>
            <textarea class="wl-neie2" style="resize: none" placeholder="添加申请备注(必填)..." id="fr-friend-remarks"></textarea>
            <button class="wl-btn" onclick="myObj.submitFriendApply()">发送</button>
        </div>
    </div>
</div>
</body>

<script src="/static/js/functions.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
    var objClass = {
        user_id:{$user_info['id']},
        listData:{
            loading:false,
            ini:false,
            page:0,
            page_total:1,
            page_size:15,
            template:function(data,obj){
                if(data.isZan == 1){
                    var css = 'icon-appreciate_fill_light souBak';
                }else{
                    var css = 'icon-appreciate_light';
                }
				return '<div class="one-1 lists" style="height: 380px;border-bottom: 10px solid #EEEEEE;position: relative">'+
						' <div class="wx-name" style="border:none;">'+' <img src="'+data.portrait+'" alt="" class="wx-tou"  onerror="this.src=\'/static/image/user/tou.png \'" >'+
                        '<dl class="wx-yh">'+'<dt style="font-size:0.28rem;color: #1D1D1D;font-weight: bold;">'+ data.nickname +'</dt>'+'<dd style="font-size:0.24rem;color: #898989;">'+ data.published_time +'</dd>'+
                       ' </dl>'+'</div>'+
                         ' <div class="wx-nei1">'+
                       ' <dl>'+
                           ' <dt style="font-size: 0.34rem;color: #1F1F1F;margin-left: 36px;cursor: pointer;"  class="cus-article-href" data-id="'+ data.id +'"  >'+data.title+'</dt>'+
                            '<dd class="cus-article-href" data-id="'+ data.id +'" >'+'<img src="'+obj.img_1 +'" alt="图片"/>'+'</dd>'+
                       ' </dl>'+'  </div>'+
                          ' <ul class="wx-fen">'+
                  '      <li><i class="iconfont icon-share_light" id="ttb"></i><span></span></li>'+
                        '<li><i class="iconfont icon-comment_light" id="ttb"></i><span style="margin-left: 15px;">'+ data.comment_count +'</span></li>'+
                       ' <li><span class="cus-article-fabulous"  data-id="'+ data.id +'"  data-click="'+ data.isZan +'"><i class="iconfont cus-tubiao '+ css +'" id="ttb" style="float: left"></i><span style="margin-left: 15px;" class="cus-article-like-num" style="float: left">'+ data.like +'</span></span></li>'+
                   ' </ul>'
				'</div>';
            },
            template1:function(data,obj){
                if(data.isZan == 1){
                    var css = 'icon-appreciate_fill_light souBak';
                }else{
                    var css = 'icon-appreciate_light';
                }

            	var src_img = '';
            	$.each(obj, function(k,v) {
            		src_img +='<img src="'+v +'" alt="" style="margin-right: 4px;"   />';
            	});
            	return '  <div class="one-2" style="min-height: 400px;border-bottom: 10px solid #EEEEEE;position: relative">'+
                   ' <div class="wx-name">'+
                       ' <img src="'+data.portrait+'" alt="" class="wx-tou" onerror="this.src=\'/static/image/user/tou.png \'">'+
                      '  <dl class="wx-yh">'+
                          '  <dt style="font-size:0.28rem;color: #1D1D1D;font-weight: bold;">'+data.nickname+'</dt>'+
                          '  <dd style="font-size:0.24rem;color: #898989;">'+ data.published_time +'</dd>'+
                       ' </dl>'+
                  '  </div>'+
                   ' <p class="on1 cus-article-href" data-id="'+ data.id +'"  style="cursor: pointer;" >'+data.title+'</p>'+
                    '<div class="on1-img cus-article-href" data-id="'+ data.id +'">'+ src_img +
                   ' </div>'+
                   ' <ul class="wx-fen">'+
                  '      <li><i class="iconfont icon-share_light" id="ttb"></i><span></span></li>'+
                        '<li><i class="iconfont icon-comment_light" id="ttb"></i><span style="margin-left: 15px;"></span></li>'+
                       '<li><span class="cus-article-fabulous"  data-id="'+ data.id +'"  data-click="'+ data.isZan +'" ><i class="iconfont cus-tubiao '+ css+'" id="ttb"></i><span style="margin-left: 15px;" class="cus-article-like-num">'+ data.like +'</span></span></li>'+
                   ' </ul>'+

               ' </div>';
               },
			template2: function(data) {
                        if(data.isZan == 1){
                            var css = 'icon-appreciate_fill_light souBak';
                        }else{
                            var css = 'icon-appreciate_light';
                        }

						return	' <div class="ont-3" style="min-height: 320px;border-bottom: 10px solid #EEEEEE;position: relative">' +
							' <div class="wx-name">' +
							'   <img src="' + data.portrait + '" alt="" class="wx-tou"  onerror="this.src=\'/static/image/user/tou.png \'" >' +
								'<dl class="wx-yh">' +
								'  <dt style="font-size:0.28rem;color: #1D1D1D;font-weight: bold;">' + data.nickname + '</dt>' +
								'<dd style="font-size:0.24rem;color: #898989;">' + data.published_time + '</dd>' +
								' </dl>' +
								'</div>' +
								' <p class="on1 cus-article-href" data-id="'+ data.id +'"  >' + data.title + '</p>' +
								' <ul class="wx-fen">' +
								' <li><i class="iconfont icon-share_light" id="ttb"></i><span></span></li>' +
								'<li><i class="iconfont icon-comment_light" id="ttb"></i><span style="margin-left: 15px;"></span></li>' +
								'<li><span class="cus-article-fabulous" data-id="'+ data.id +'"  data-click="'+ data.isZan +'" ><i class="iconfont cus-tubiao '+ css +'" id="ttb"></i><span style="margin-left: 15px;" class="cus-article-like-num">'+ data.like +'</span></span></li>' +
								'</ul>' +
								' </div>'
            },
		},
        //相关推荐数据加载
        loadList:function(me){
            if(this.listData.loading){
                return false;
            }
            this.listData.page++;
            if(this.listData.ini == true){
                if(this.listData.page > this.listData.page_total){
                    me.resetload();
                    return false;
                }
            }
            $.ajax({
                url:"/weixin/Article/getUserPublishArticle",
                type:'post',
                data:{user_id:objClass.user_id,type:1,page:objClass.listData.page,page_size:objClass.listData.page_size},
                dataType:'json',
                beforeSend:function(){
                    objClass.listData.loading = true;
                },
                complete:function(){
                    objClass.listData.loading = false;
                },
                success:function(res){
                    if(res.code == 200){
                        if(objClass.listData.ini == false){
                        	$('#wl-article').html('');
                            objClass.listData.ini = true;
                            objClass.listData.page_total = res.data.page_total;
                        }
                        $.each(res.data.rows,function(k,val){
                                var html = '';
                                if(val.thumbnail != '' && val.thumbnail != null){
                                	var obj = $.parseJSON(val.thumbnail);
									var arr = Object.keys(obj);
					            	if(arr.length < 3){
					            		html = objClass.listData.template(val,obj);
					            	}else {
					            		html = objClass.listData.template1(val,obj);
					            	}
                                }else {
                                	html = objClass.listData.template2(val);
                                }
				            	$('#wl-article').append(html);
                        });
                        if(objClass.listData.page >= objClass.listData.page_total){
		                    me.noData();
                        }
                    }
                    me.resetload();
                }
            });
        },
    };

 	$('.content').dropload({
        scrollArea : window,
        loadUpFn:function(me){
        	objClass.listData.loading = false;
        	objClass.listData.ini = false;
        	objClass.listData.page = 0;
        	objClass.listData.page_total = 1;
        	objClass.loadList(me);
        },
        loadDownFn : function(me){
            objClass.loadList(me);
        }
    });

    //视频加载
    var objClass1 = {
        user_id:{$user_info['id']},
        listData:{
            loading:false,
            ini:false,
            page:0,
            page_total:1,
            page_size:15,
            template2: function(data) {
                return '  <div class="one-1">' +
                    '<div class="wx-name">' +
                    '<img src="'+data.portrait+'" alt="" /class="wx-tou">' +
                    ' <dl class="wx-yh">' +
                    '<dt style="font-size:0.28rem;color: #1D1D1D;font-weight: bold;">'+data.nickname+'</dt>' +
                    '  <dd style="font-size:0.24rem;color: #898989;">'+data.published_time+'</dd>' +
                    '</dl>' +
                    ' </div>' +
                    ' <p class="on1">'+data.title+'</p>' +
                    ' <video src="" controls="controls" class="wx-video"></video>' +

                    ' <ul class="wx-fen">' +
                    ' <li><i class="iconfont icon-share_light" id="ttb"></i><span></span></li>' +
                    '<li><i class="iconfont icon-comment_light" id="ttb"></i><span style="margin-left: 15px;"></span></li>' +
                    '<li><span class="cus-article-fabulous"><i class="iconfont icon-appreciate_light cus-tubiao" id="ttb"></i><span style="margin-left: 15px;" class="cus-article-like-num"></span></span></li>' +
                    '</ul>' +
                    ' </div>'+' </div>'
            }
        },//相关推荐数据加载
        loadList:function(me){
            if(this.listData.loading){
                return false;
            }

            this.listData.page++;
            if(this.listData.ini == true){
                if(this.listData.page > this.listData.page_total){
                    me.resetload();
                    return false;
                }
            }

            $.ajax({
                url:"/weixin/Article/getUserPublishArticle",
                type:'post',
                data:{user_id:objClass1.user_id,type:2,page:objClass1.listData.page,page_size:objClass1.listData.page_size},
                dataType:'json',
                beforeSend:function(){
                    objClass1.listData.loading = true;
                },
                complete:function(){
                    objClass1.listData.loading = false;
                },
                success:function(res){
                    if(res.code == 200){
                        if(objClass1.listData.ini == false){
                            $('#wl-video').html('');
                            objClass1.listData.ini = true;
                            objClass1.listData.page_total = res.data.page_total;
                        }

                        $.each(res.data.rows,function(k,val){
                            var html = objClass1.listData.template2(val);
                            $('#wl-video').append(html);
                        });

                        if(objClass1.listData.page >= objClass1.listData.page_total){
                            me.noData();
                        }
                    }

                    me.resetload();
                }
            });
        },
        clickFabulous:function(obj){
            var id = obj.data('id');
            var type = obj.data('click') == 1 ?2:1;
            $.ajax({
                url:"/weixin/article/clickZan",
                type:'post',
                data:{id:id,type:type},
                dataType:'json',
                beforeSend:function(){
                    objClass.oneLoading = true;
                },
                complete:function(){
                    objClass.oneLoading = false;
                },
                success:function(res){
                    if(res.code == 200){
                        if(type == 1){
                            obj.data('click',1);
                            obj.find('.cus-article-like-num').text(parseInt(obj.find('.cus-article-like-num').text()) + 1);
                            obj.find('.cus-tubiao').removeClass('icon-appreciate_light').addClass('icon-appreciate_fill_light').addClass('souBak');
                        }else{
                            obj.data('click',0);
                            obj.find('.cus-article-like-num').text(parseInt(obj.find('.cus-article-like-num').text()) -1);
                            obj.find('.cus-tubiao').removeClass('icon-appreciate_fill_light').removeClass('souBak').addClass('icon-appreciate_light');
                        }
                    }else if(res.code == 401){
                        alert('请先进行登录');
                    }
                }
            });
        },
    };
    $('.content2').dropload({
        scrollArea : window,
        loadUpFn:function(me){
        	objClass1.listData.loading = false;
        	objClass1.listData.ini = false;
        	objClass1.listData.page = 0;
        	objClass1.listData.page_total = 0;
        	objClass1.loadList(me);
        },
        loadDownFn : function(me){
            objClass1.loadList(me);
        }
    });

    $(document).on('click','.cus-article-fabulous',function(event){
       objClass1.clickFabulous($(this));
    });

    $(document).on('click','.cus-article-href',function(){
        window.location.href = '/weixin/article/articleDetails/id/'+ $(this).data('id');
    });
</script>
<script type="text/javascript">
    $(function () {
        $(".ones").show();
        $(".top span").eq(0).addClass("se");
        var a,b,c,index = 0;
        $(".top span").click(function () {
            index = $(this).index();
            $(".xia .one").eq(index).show().siblings().hide();
            $(".top span").eq(index).addClass("se").siblings().removeClass("se");
            if (index == 0) {
                a = 1;
            }
            if (index == 1) {
                b = 1;
            }
            if (index == 2) {
                c = 1;
            }
            if (a == 1 && b == 1 && c == 1) {
                $("#xiao").hide();
            }
        })
    });

    $(function () {
        $(window).scroll(function () {
            if ($(window).scrollTop() > 526) {
                $("#ul").addClass("ul");
            } else if ($(window).scrollTop() <= 526) {
                $("#ul").removeClass("ul");
                $("#ul").addClass("cc");
            }
        })
    });
</script>
<script type="text/javascript">
    $(".wl-zhezhao").click(function(event) {
        var _con = $('.wl-zhe1'); // 设置目标区域
        if(!_con.is(event.target) && _con.has(event.target).length == 0) {
            $('.wl-zhezhao').hide(); //淡出消失
        }
    });

    var myObj = {
        isAdd:false,
        addFriendLoading:false,
        showAddFriend:function(){
            if(!this.isAdd){
                $(".wl-zhezhao").toggle();
            }else{
                redream.showTip('不能重复申请...');
            }
        },
        submitFriendApply:function(){
            var remarks = $.trim($('#fr-friend-remarks').val());
            if(redream.isEmptyStr(remarks)){
                redream.showTip('申请备注不能为空...');
                return false;
            }else if(!this.addFriendLoading){
                $.ajax({
                    url: "/weixin/user/addFriend",
                    type: 'post',
                    data: {friend_id:{$uid},remarks:remarks},
                    dataType: 'json',
                    beforeSend:function(){
                        myObj.addFriendLoading = true;
                    },
                    complete:function(){
                        myObj.addFriendLoading = false;
                    },
                    success: function (res) {
                        if (res.code == 200) {
                            myObj.isAdd = true;
                            $(".wl-zhezhao").toggle();
                        }else if (res.code == 401){
                            redream.showTip('请先进行登录');
                        }else if (res.code == 403){
                            redream.showTip('您还没有授权');
                        }else{
                            redream.showTip(res.msg);
                        }
                    }
                });
            }
        }
    }
</script>
</html>